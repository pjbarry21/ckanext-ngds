<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>env.py</title>
  <link rel="stylesheet" href="../../pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  <div class='section'>
    <div class='docs'><h1>env.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>Sometimes we need access to CKAN objects that we can't get at through
    ckan.plugins.toolkit. If we import those things here and need to adjust
    in the future, we can do that adjustment in one place.</p>
<p>This also allows us to "spoof" CKAN objects we need, without relying directly on CKAN, e.g. Session</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>If you have to use ckan.model...</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">from</span> <span class="nn">ckan</span> <span class="kn">import</span> <span class="n">model</span> <span class="k">as</span> <span class="n">ckan_model</span>
<span class="kn">from</span> <span class="nn">ckan</span> <span class="kn">import</span> <span class="n">logic</span> <span class="k">as</span> <span class="n">ckan_logic</span>
<span class="kn">from</span> <span class="nn">ckan</span> <span class="kn">import</span> <span class="n">lib</span> <span class="k">as</span> <span class="n">ckan_lib</span>
<span class="kn">from</span> <span class="nn">pylons</span> <span class="kn">import</span> <span class="n">config</span> <span class="k">as</span> <span class="n">ckan_config</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>Create a CKAN database session without relying on CKAN
Define a SQLAlchemy Session from ckan_config</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="n">dburl</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">db_str</span> <span class="o">=</span> <span class="n">ckan_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dburl</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">create_engine</span><span class="p">(</span><span class="n">db_str</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>

<span class="n">Session</span> <span class="o">=</span> <span class="n">_setup</span><span class="p">(</span><span class="s">&quot;sqlalchemy.url&quot;</span><span class="p">)</span>

<span class="n">DataStoreSession</span> <span class="o">=</span> <span class="n">_setup</span><span class="p">(</span><span class="s">&quot;ckan.datastore.write_url&quot;</span><span class="p">)</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
