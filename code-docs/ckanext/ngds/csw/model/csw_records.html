<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>csw_records.py</title>
  <link rel="stylesheet" href="../../../../pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  <div class='section'>
    <div class='docs'><h1>csw_records.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Table</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span>

<span class="kn">from</span> <span class="nn">ckan</span> <span class="kn">import</span> <span class="n">model</span>
<span class="kn">from</span> <span class="nn">ckan.model</span> <span class="kn">import</span> <span class="n">meta</span><span class="p">,</span> <span class="n">Package</span>

<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">asShape</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>Class representing CSW Records that are stored in the database and served via CSW</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">CswRecord</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">package_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">package_id</span> <span class="o">=</span> <span class="n">package_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;identifier&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;typename&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;schema&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mdsource</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;mdsource&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_date</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;insert_date&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xml</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;xml&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anytext</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;anytext&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;language&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title_alternate</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;title_alternate&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abstract</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;abstract&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keywords</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;keywords&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keywordstype</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;keywordstype&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parentidentifier</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;parentidentifier&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;relation&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_begin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;time_begin&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;time_end&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topicategory</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;topicategory&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcelanguage</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;resourcelanguage&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creator</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;creator&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">publisher</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;publisher&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contributor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;contributor&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">organization</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;organization&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">securityconstraints</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;securityconstraints&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accessconstraints</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;accessconstraints&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">otherconstraints</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;otherconstraints&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_revision</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;date_revision&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_creation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;date_creation&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_publication</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;date_publication&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_modified</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;date_modified&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;format&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;source&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;crs&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geodescode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;geodescode&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distancevalue</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;distancevalue&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distanceuom</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;distanceuom&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wkt_geometry</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;wkt_geometry&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">servicetype</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;servicetype&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">servicetypeversion</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;servicetypeversion&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;operation&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">couplingtype</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;couplingtype&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operateson</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;operateson&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operatesonidentifier</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;operatesonidentifier&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operatesoname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;operatesoname&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;degree&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classification</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;classification&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conditionapplyingtoaccessanduse</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;conditionapplyingtoaccessanduse&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineage</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;lineage&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">responsiblepartyrole</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;responsiblepartyrole&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specificationtitle</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;specificationtitle&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specificationdate</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;specificationdate&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specificationdatetype</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;specificationdatetype&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">links</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;links&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>Create an instance of CswRecord from an ckanext.ngds.metadata.model.iso_package:IsoPackage</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">format_links</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">resources</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Format links for pycsw usage: &quot;name,description,protocol,url[^,,,[^,,,]]&quot;&#39;&#39;&#39;</span>
        <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
            <span class="n">link</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">,&quot;</span> <span class="o">%</span> <span class="n">resource</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">link</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">,&quot;</span> <span class="o">%</span> <span class="n">resource</span><span class="p">[</span><span class="s">&quot;description&quot;</span><span class="p">]</span>
            <span class="n">link</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">,&quot;</span> <span class="o">%</span> <span class="n">resource</span><span class="p">[</span><span class="s">&quot;protocol&quot;</span><span class="p">]</span>
            <span class="n">link</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">resource</span><span class="p">[</span><span class="s">&quot;url&quot;</span><span class="p">]</span>
            <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="s">&quot;^&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">format_keywords</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">iso_package</span><span class="p">):</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span> <span class="n">keyword</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">iso_package</span><span class="o">.</span><span class="n">dataset_info</span><span class="p">[</span><span class="s">&quot;keywords&quot;</span><span class="p">]</span> <span class="p">]</span>
        <span class="k">if</span> <span class="n">iso_package</span><span class="o">.</span><span class="n">dataset_info</span><span class="p">[</span><span class="s">&quot;extent_keyword&quot;</span><span class="p">]:</span>
            <span class="n">keywords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iso_package</span><span class="o">.</span><span class="n">dataset_info</span><span class="p">[</span><span class="s">&quot;extent_keyword&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keywords</span><span class="p">)</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_iso_package</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">iso_package</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">creation_args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&quot;package_id&quot;</span><span class="p">:</span> <span class="n">iso_package</span><span class="o">.</span><span class="n">ckan_package</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s">&quot;identifier&quot;</span><span class="p">:</span> <span class="n">iso_package</span><span class="o">.</span><span class="n">metadata_info</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">],</span>
            <span class="s">&quot;typename&quot;</span><span class="p">:</span> <span class="s">&quot;gmd:MD_Metadata&quot;</span><span class="p">,</span>
            <span class="s">&quot;schema&quot;</span><span class="p">:</span> <span class="s">&quot;http://www.isotc211.org/2005/gmd&quot;</span><span class="p">,</span>
            <span class="s">&quot;mdsource&quot;</span><span class="p">:</span> <span class="s">&quot;local&quot;</span><span class="p">,</span>
            <span class="s">&quot;insert_date&quot;</span><span class="p">:</span> <span class="n">iso_package</span><span class="o">.</span><span class="n">metadata_info</span><span class="p">[</span><span class="s">&quot;updated&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s">&quot;xml&quot;</span><span class="p">:</span> <span class="n">iso_package</span><span class="o">.</span><span class="n">to_iso_xml</span><span class="p">(),</span>
            <span class="s">&quot;anytext&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;language&quot;</span><span class="p">:</span> <span class="n">iso_package</span><span class="o">.</span><span class="n">metadata_info</span><span class="p">[</span><span class="s">&quot;language&quot;</span><span class="p">],</span>
            <span class="s">&quot;type&quot;</span><span class="p">:</span> <span class="n">iso_package</span><span class="o">.</span><span class="n">dataset_info</span><span class="p">[</span><span class="s">&quot;category&quot;</span><span class="p">],</span>
            <span class="s">&quot;title&quot;</span><span class="p">:</span> <span class="n">iso_package</span><span class="o">.</span><span class="n">dataset_info</span><span class="p">[</span><span class="s">&quot;title&quot;</span><span class="p">],</span>
            <span class="s">&quot;abstract&quot;</span><span class="p">:</span> <span class="n">iso_package</span><span class="o">.</span><span class="n">dataset_info</span><span class="p">[</span><span class="s">&quot;abstract&quot;</span><span class="p">],</span>
            <span class="s">&quot;keywords&quot;</span><span class="p">:</span> <span class="n">cls</span><span class="o">.</span><span class="n">format_keywords</span><span class="p">(</span><span class="n">iso_package</span><span class="p">),</span>
            <span class="s">&quot;keywordstype&quot;</span><span class="p">:</span> <span class="s">&quot;theme&quot;</span><span class="p">,</span>
            <span class="s">&quot;parentIdentifier&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;relation&quot;</span><span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="s">&quot;time_begin&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;time_end&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;topicategory&quot;</span><span class="p">:</span> <span class="n">iso_package</span><span class="o">.</span><span class="n">dataset_info</span><span class="p">[</span><span class="s">&quot;topic&quot;</span><span class="p">],</span>
            <span class="s">&quot;resourcelanguage&quot;</span><span class="p">:</span> <span class="n">iso_package</span><span class="o">.</span><span class="n">dataset_info</span><span class="p">[</span><span class="s">&quot;language&quot;</span><span class="p">],</span>
            <span class="s">&quot;creator&quot;</span><span class="p">:</span> <span class="s">&quot;creator&quot;</span><span class="p">,</span>
            <span class="s">&quot;publisher&quot;</span><span class="p">:</span> <span class="s">&quot;publisher&quot;</span><span class="p">,</span>
            <span class="s">&quot;contributor&quot;</span><span class="p">:</span> <span class="s">&quot;contributor&quot;</span><span class="p">,</span>
            <span class="s">&quot;organization&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;securityconstraints&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;accessconstraints&quot;</span><span class="p">:</span> <span class="n">iso_package</span><span class="o">.</span><span class="n">dataset_info</span><span class="p">[</span><span class="s">&quot;usage&quot;</span><span class="p">],</span>
            <span class="s">&quot;otherconstraints&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;date&quot;</span><span class="p">:</span> <span class="n">iso_package</span><span class="o">.</span><span class="n">metadata_info</span><span class="p">[</span><span class="s">&quot;updated&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s">&quot;date_revision&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;date_creation&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;date_publication&quot;</span><span class="p">:</span> <span class="n">iso_package</span><span class="o">.</span><span class="n">dataset_info</span><span class="p">[</span><span class="s">&quot;publication_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s">&quot;date_modified&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;format&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;source&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;crs&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;geodescode&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;denominator&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;distancevalue&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;distanceuom&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;wkt_geometry&quot;</span><span class="p">:</span> <span class="n">asShape</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">iso_package</span><span class="o">.</span><span class="n">dataset_info</span><span class="p">[</span><span class="s">&quot;extent&quot;</span><span class="p">]))</span><span class="o">.</span><span class="n">wkt</span><span class="p">,</span>
            <span class="s">&quot;servicetype&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;servicetypeversion&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;operation&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;couplingtype&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;operateson&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;operatesonidentifier&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;degree&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;conditionapplyingtoaccessanduse&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;lineage&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;responsiblepartyrole&quot;</span><span class="p">:</span> <span class="s">&quot;distributor&quot;</span><span class="p">,</span> <span class="c"># huh?</span>
            <span class="s">&quot;specificationtitle&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;specificationdate&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;spcificationdatetype&quot;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&quot;links&quot;</span><span class="p">:</span> <span class="n">cls</span><span class="o">.</span><span class="n">format_links</span><span class="p">(</span><span class="n">iso_package</span><span class="o">.</span><span class="n">resources</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="n">record</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="o">**</span><span class="n">creation_args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">record</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>Create in-memory representation of the tables, configure mappings to 
python classes, and return the tables</p>
<p>Table generation code is lifted from pycsw</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">define_tables</span><span class="p">():</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">csw_record</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
        <span class="s">&quot;csw_record&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
        
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;package_id&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s">&quot;package.id&quot;</span><span class="p">)),</span> <span class="c"># Implicit Foreign Key to the package</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>core; nothing happens without these</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;identifier&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;typename&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
               <span class="n">default</span><span class="o">=</span><span class="s">&#39;csw:Record&#39;</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;schema&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span>
               <span class="n">default</span><span class="o">=</span><span class="s">&#39;http://www.opengis.net/cat/csw/2.0.2&#39;</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
               <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;mdsource&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;local&#39;</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
               <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;insert_date&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;xml&#39;</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;anytext&#39;</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;language&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>identification</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;title_alternate&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;abstract&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;keywords&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">UnicodeText</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;keywordstype&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;parentidentifier&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;relation&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;time_begin&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;time_end&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;topicategory&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;resourcelanguage&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>attribution</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;creator&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;publisher&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;contributor&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;organization&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>security</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;securityconstraints&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;accessconstraints&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;otherconstraints&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>date</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;date&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;date_revision&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;date_creation&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;date_publication&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;date_modified&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>

        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;format&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;source&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">1024</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>geospatial</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;crs&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;geodescode&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;denominator&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;distancevalue&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;distanceuom&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;wkt_geometry&#39;</span><span class="p">,</span> <span class="n">Text</span><span class="p">),</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>service</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;servicetype&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;servicetypeversion&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;operation&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;couplingtype&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;operateson&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;operatesonidentifier&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;operatesoname&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>additional</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;degree&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;classification&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;conditionapplyingtoaccessanduse&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;lineage&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;responsiblepartyrole&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;specificationtitle&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;specificationdate&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;specificationdatetype&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>distribution
links: format "name,description,protocol,url[^,,,[^,,,]]"</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Column</span><span class="p">(</span><span class="s">&#39;links&#39;</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>Map the table to the class...</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">meta</span><span class="o">.</span><span class="n">mapper</span><span class="p">(</span>
        <span class="n">CswRecord</span><span class="p">,</span> 
        <span class="n">csw_record</span><span class="p">,</span>
        <span class="n">properties</span><span class="o">=</span><span class="p">{</span>
            <span class="s">&quot;package&quot;</span><span class="p">:</span> <span class="n">relationship</span><span class="p">(</span><span class="n">Package</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>put the CswRecord class intp CKAN model for later reference</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">model</span><span class="o">.</span><span class="n">CswRecord</span> <span class="o">=</span> <span class="n">CswRecord</span>
    
    <span class="k">return</span> <span class="n">csw_record</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>Create tables in the database</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">def</span> <span class="nf">db_setup</span><span class="p">():</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>These tables will already be defined in memory if the csw plugin is enabled.
 IConfigurer will make a call to define_tables()</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">csw_record</span> <span class="o">=</span> <span class="n">meta</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;csw_record&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">csw_record</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>The tables have not been defined. Its likely that the plugin is not enabled in the CKAN .ini file</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Could not create CSW tables. Please make sure that you&#39;ve added the csw plugin to your CKAN config .ini file.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;CSW tables defined in memory&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>Alright. Create the tables.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="kn">from</span> <span class="nn">ckanext.ngds.base.commands.ngds_tables</span> <span class="kn">import</span> <span class="n">create_tables</span>
        <span class="n">create_tables</span><span class="p">([</span><span class="n">csw_record</span><span class="p">],</span> <span class="n">log</span><span class="p">)</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
