ngds.config={number_of_rows:10};if(typeof ngds.Search!=="undefined"){}ngds.feature_event_manager={};ngds.layer_map={};(function setup_control_styles(){ngds.subscribe("Map.loaded",function(a,b){})})();if(typeof ngds.Map!=="undefined"){$(document).ready(function(){ngds.Map.initialize()});ngds.Map.top_level_search=function(){ngds.publish("Map.expander.toggle",{});ngds.pager=new ngds.Search();ngds.publish("Map.search_initiated",{});var b=ngds.Map.get_layer("drawnItems");var a=$("#map-query").val();ngds.util.clear_map_state();ngds.pager.go_to({page:1,action:ngds.ckanlib.package_search,rows:ngds.config.number_of_rows,q:a})};$("#map-query").on("change",function(){ngds.publish("Map.clear_rect",{})})}(function publish_pager_advance(){$("#map-search").click(function(){ngds.Map.top_level_search()});$(".search-results-page-nums").on("click",null,function(a){var b=a.target.firstChild.data;if(b==="<"){b=Number(ngds.Map.cur_page)-1}if(b===">"){b=Number(ngds.Map.cur_page)+1}if(b===0){b=1}if(b>=ngds.Map.num_pages){b=ngds.Map.num_pages}if(typeof b==="undefined"){return}ngds.log("Going to page : "+b);ngds.publish("page.advance",{page:b})})})();(function subscribe_page_advance(){ngds.subscribe("page.advance",function(b,a){ngds.feature_ngds_id_mapping={};ngds.util.clear_map_state();ngds.Map.zoom_handler.clear_listeners();ngds.pager.go_to({page:a.page,action:ngds.ckanlib.package_search,rows:10})})})();(function subscribe_data_loading(){ngds.subscribe("data-loading",function(b,a){ngds.publish("Map.results_hide",{});ngds.Map.map.fireEvent("dataloading")})})();(function subscribe_data_loaded(){ngds.subscribe("data-loaded",function(b,a){ngds.publish("Map.results_rendered",{});ngds.Map.map.fireEvent("dataload")})})();if(typeof ngds.Map!=="undefined"){$(document).ready(function(){ngds.Map.map.on("draw:rectangle-created",function(a){ngds.Map.clear_layer("drawnItems");ngds.Map.add_to_layer([a.rect],"drawnItems");ngds.publish("Map.area_selected",{type:"rectangle",feature:a})});ngds.Map.map.on("draw:poly-created",function(a){ngds.Map.clear_layer("drawnItems");ngds.Map.add_to_layer([a.poly],"drawnItems");ngds.publish("Map.area_selected",{type:"polygon",feature:a})})})}(function subscribe_feature_received(){ngds.subscribe("Map.feature_received",function(a,b){ngds.Map.add_raw_result_to_geojson_layer(b.feature,{seq:b.seq,alph_seq:b.alph_seq})});$(".map-search-results").on("mouseover",null,function(c){var b="";if(typeof c.srcElement==="undefined"){b=c.target}else{b=c.srcElement}var d=ngds.util.node_matcher(b,/result-\d.*/);if(d===null){return}var a={layer:ngds.layer_map[d]};ngds.publish("Layer.mouseover",{Layer:a,tag_index:d})});$(".map-search-results").on("mouseout",null,function(c){var b="";if(typeof c.srcElement==="undefined"){b=c.target}else{b=c.srcElement}var d=ngds.util.node_matcher(b,/result-\d.*/);if(d===null){return}var a={layer:ngds.layer_map[d]};ngds.publish("Layer.mouseout",{Layer:a,tag_index:d})});$(".map-search-results").on("click",null,function(c){var b="";if(typeof c.srcElement==="undefined"){b=c.target}else{b=c.srcElement}var d=ngds.util.node_matcher(b,/result-\d.*/);if(d===null||typeof d==="undefined"){return}ngds.util.reset_result_styles();var a={layer:ngds.layer_map[d]};ngds.publish("Layer.click",{Layer:a,tag_index:d})})})();(function setup_styler_for_features(){ngds.subscribe("Layer.mouseover",function(a,c){if(typeof c.Layer==="undefined"||typeof c.Layer.layer==="undefined"){return}var b=c.Layer.layer.is_active||null;if(b===null||b===false){ngds.util.apply_feature_hover_styles(c.Layer.layer,c.tag_index)}});ngds.subscribe("Layer.mouseout",function(a,c){if(typeof c.Layer==="undefined"||typeof c.Layer.layer==="undefined"){return}var b=c.Layer.layer.is_active||null;if(b===null||b===false){ngds.util.apply_feature_default_styles(c.Layer.layer,c.tag_index)}});ngds.subscribe("Layer.click",function(d,e){if(typeof e.Layer==="undefined"||typeof e.Layer.layer==="undefined"){return}ngds.util.reset_result_styles();for(var b in ngds.layer_map){ngds.util.apply_feature_default_styles(ngds.layer_map[b],b);if(ngds.layer_map[b]._leaflet_id===e.Layer.layer._leaflet_id){ngds.layer_map[b].is_active=true}else{ngds.layer_map[b].is_active=false}}var a=e.Layer.layer._latlng||e.Layer.layer._latlngs;var c=(function(g){if(typeof g==="object"&&typeof g[0]==="undefined"){return g}var h=ngds.Map.utils.get_bound(g,"lat","min");var j=ngds.Map.utils.get_bound(g,"lat","max");var f=ngds.Map.utils.get_bound(g,"lng","min");var i=ngds.Map.utils.get_bound(g,"lng","max");return{lat:(h+j)/2,lng:(f+i)/2}})(a);ngds.Map.map.panTo(c);e.Layer.layer.openPopup();ngds.util.apply_feature_active_styles(e.Layer,e.tag_index)});ngds.subscribe("Layer.add",function(a,b){});ngds.subscribe("Layer.remove",function(a,b){})})();(function setup_events_for_map_features(){ngds.subscribe("Map.add_feature",function(a,c){var b=c.feature;ngds.layer_map[c.seq_id]=b;ngds.util.apply_feature_default_styles(b,c.seq_id);ngds.feature_event_manager[b._leaflet_id]={Layer:b,seq_id:c.seq_id};ngds.publish("Map.layer_added",{});b.on("mouseover",function(d){ngds.publish("Layer.mouseover",{Layer:d,tag_index:c.seq_id})});b.on("mouseout",function(d){ngds.publish("Layer.mouseout",{Layer:d,tag_index:c.seq_id})});b.on("click",function(d){ngds.publish("Layer.click",{Layer:d,tag_index:c.seq_id})})})})();ngds.subscribe("Map.results_rendered",function(a,b){$(".visibility-managed").show();$(".results").jScrollPane({contentWidth:"0px",hideFocus:true})});ngds.subscribe("Map.results_hide",function(a,b){$(".visibility-managed").hide()});$(document).ready(function(){var a=false;$(".map-expander").on("click",function(){if(a===false){$(".visibility-managed").hide();a=true}else{$(".visibility-managed").show();a=false}})});(function(){ngds.subscribe("Map.size_changed",function(a,b){if(b.fullscreen===true){ngds.Map.state["map-search-results-left"]=$(".map-search-results").css("left");ngds.Map.state["map-search-results-top"]=$(".map-search-results").css("top");ngds.Map.state["map-search-left"]=$(".map-search").css("left");ngds.Map.state["map-search-top"]=$(".map-search").css("top");$(".map-search").css({left:"10px",position:"fixed"});$(".map-search-results").css({left:"10px",position:"fixed"})}else{$(".map-search").css({left:ngds.Map.state["map-search-left"],top:ngds.Map.state["map-search-top"],position:"absolute"});$(".map-search-results").css({left:ngds.Map.state["map-search-results-left"],top:ngds.Map.state["map-search-results-top"],position:"absolute"})}})})();$(document).ready(function(){ngds.Map.map.on("zoomend",ngds.util.make_prominent)});ngds.subscribe("Map.layer_added",function(){ngds.util.make_prominent()});