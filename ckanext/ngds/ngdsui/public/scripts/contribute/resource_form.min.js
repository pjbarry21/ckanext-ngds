var populate_content_models=function(){var a=$(".content_model");if(typeof options==="undefined"){options=[];options.push($("<option/>",{value:"none",text:"None"}).appendTo(a));for(var c in content_models){options.push($("<option/>",{value:c,text:content_models[c].title}).appendTo(a))}return}for(var b=0;b<options.length;b++){options[b].appendTo(a)}};var populate_content_model_versions=function(){var c=$(".content_model_marker");var b=$(".content_model");if(b.val()==="none"){return}$(".content_model_version_marker").remove();var a=[{label:"Version",div_classes:["content_model_version_marker"],inputs:[{tag:"select",attributes:{"class":"structured-input content_model_version",name:"content_model_version"}}]}];b.after(form_generator(a));var d=$(".content_model_version");var f=b.val();for(var e=0;e<content_models[f].versions.length;e++){$("<option/>",{value:content_models[f].versions[e].uri,text:content_models[f].versions[e].version}).appendTo(d)}};$("#file").on("change",function(c){var d=new Date().toISOString();var b=$("#file").val();var a=b.substring(b.lastIndexOf("\\")+1);$("#key1").val(d+"/"+a);$("#key2").val(d+"/"+a);$("#resource_type").val($("[name=resource_format]:checked").val());$("#file-upload-form").submit()});var populate_form=function(a){for(property in a){if($("[name="+property+"]").length>0){if(property==="distributor"){}$("[name="+property+"]").val(a[property])}}};var activate_populate_form=function(b){render_forms(b.resource_format);populate_form(b);$("#resource_type-selection").prop("disabled",true);$("input[type=radio]").prop("disabled",true);var a=get_prop($("#field-url").val(),"name");var c=get_prop($("#field-url").val(),"extension");$("[name=name]").val(a);$("[name=format]").val(c)};var get_prop=function(a,c){if(typeof a==="undefined"||a.length===0){return""}var b=a.substring(a.lastIndexOf("/")+1);if(c==="name"){return b.split(".")[0]}if(c==="extension"){return b.split(".")[1]}};position_file_uploader();var render_forms=function(a){$(".form-body").empty();if(a==="structured"||a==="unstructured"){$("[name=upload_type_selection]").prop("checked",true)}else{$("[name=upload_type_selection]").prop("checked",false)}if(a==="structured"){$("#resource_type-structured").prop("checked",true);$(".form-body").replaceWith(form_generator(ngds.form.structured_form_fields));position_file_uploader("#field-url");populate_content_models();$(".form-body").on("change",".content_model",function(){populate_content_model_versions()})}if(a==="unstructured"){$("#resource_type-unstructured").prop("checked",true);$(".form-body").replaceWith(form_generator(ngds.form.unstructured_form_fields));if(ngds.util.state.edit_mode!==true){position_file_uploader("#field-url")}}if(a==="offline-resource"){$("#offline-resource").prop("checked",true);$(".form-body").replaceWith(form_generator(ngds.form.offline_form_fields));position_file_uploader()}if(a==="data-service"){$(".form-body").replaceWith(form_generator(ngds.form.data_service_form_fields));position_file_uploader()}if(a==="data-service"||a==="unstructured"||a==="structured"){responsibilified=new ngds.responsible_party();responsibilified.responsibilify({rs_name:"#distributor_name",rs_email:"#distributor_email",rs_fake:"#distributor_fake",rs:"#distributor",slug_container:".distributor-tag"},function(b){$("[name='distributor_name']").val(b.name);$("[name='distributor_email']").val(b.email)})}setTimeout(function(){window.onbeforeunload=null},500);console.log(window.onbeforeunload);ngds.publish("Forms.reinitialize",{})};$('input[name="resource_format"]').on("change",function(a){var c=a.currentTarget.id;var b="";if(c==="resource_type-unstructured"){b="unstructured"}if(c==="resource_type-structured"){b="structured"}if(c==="offline-resource"){b="offline-resource"}if(c==="data-service"){b="data-service"}render_forms(b);window.onbeforeunload=null});$("#go-metadata").click(function(){$.ajax({url:"/ngds/contribute/validate_resource",data:$(".dataset-form").serializeArray(),success:function(a){if(a.success===true){$(".dataset-form").append($("<input/>",{type:"hidden",name:"save",value:"go-metadata"}));$(".dataset-form").submit()}else{ngds.publish("Notifications.received",a)}}})});if(typeof continuation!=="undefined"){for(var i=0;i<continuation.length;i++){$("[name="+continuation.field+"]").vall(continuation.value)}};