ngds.ckanlib={dataset_geo:function(c,d){var b="/api/2/search/dataset/geo?bbox=";if(!typeof c==="object"){throw"Parameter bbox : Expected a BoundingBox Object."}$.each(c.get_bbox_array(),function(f,e){(function(g){if(g===null||typeof g==="undefined"){throw"Missing parameter : Expected minx,miny,maxx,maxy."}})(e)});(function(){if(typeof d!=="function"){throw"Missing parameter : Expected callback function."}})();var a=b+c.get_bbox_array().join(",");$.ajax({url:a,type:"GET",dataType:"JSON",success:function(e){return d(e)}})},dataset_poly_geo:function(c,e){(function(){if(c===null||typeof c==="undefined"){throw"Missing parameter : Expected an array of coordinates representing a polygon."}if(typeof e!=="function"){throw"Missing parameter : Expected callback function."}})();if(c.length===0){return}var a="/poly";var d={data:JSON.stringify({poly:c})};var b="POST";$.ajax({url:a,data:d,success:function(f){return e(f)}})},package_show:function(c,d){ngds.publish("data-loading",{});(function(){if(c===null||typeof c==="undefined"){throw"Missing parameter : Expected package_id."}if(typeof d!=="function"){throw"Missing parameter : Expected callback function."}})();var a="/api/action/package_show";var b=JSON.stringify({id:c});$.ajax({url:a,type:"POST",dataType:"JSON",data:b,success:function(e){ngds.publish("data-loaded",{});return d(e)}})},package_search:function(b,m){(function(){if(b!==null&&typeof b!=="undefined"){if(typeof b==="undefined"){throw"Expected an object as the second parameter."}}if(typeof m!=="function"){throw"Expected a callback function."}})();var l=null;var g=b.q.match(/ near /);var f=b.q.match(/^near /);var d=null;var a=false;if(g!==null||f!==null){a=true}if(g!==null){d=" near "}else{d="near "}if(a===true){var i=b.q.split(d);l=i[1];var k=b.q=i[0];var n=new L.GeoSearch.Provider.OpenStreetMap();var e=n.GetServiceUrl(l);ngds.publish("data-loading",{});$.getJSON(e,function(v){var r=ngds.ckanlib.transform_neg;var q=ngds.ckanlib.transform_pos;var u=Math.min(r(v[0]["boundingbox"][0]),q(v[0]["boundingbox"][1]));var t=Math.max(r(v[0]["boundingbox"][0]),q(v[0]["boundingbox"][1]));var s=Math.min(r(v[0]["boundingbox"][2]),q(v[0]["boundingbox"][3]));var p=Math.max(r(v[0]["boundingbox"][2]),q(v[0]["boundingbox"][3]));var o=s+","+u+","+p+","+t;new L.rectangle([[u,s],[t,p]],{color:"green",dashArray:"5,5",weight:"3",opacity:1,fillOpacity:0}).addTo(ngds.Map.geoJSONLayer);b.extras["ext_bbox"]=o;ngds.ckanlib.package_search(b,function(w){ngds.publish("data-loaded",{});return m(w)})});return}ngds.publish("data-loading",{});var c="/api/action/package_search";var j="POST";var h={sort:""};for(key in b){if(b[key]!==null&&typeof b[key]!=="undefined"){h[key]=b[key]}}$.ajax({url:c,type:j,dataType:"JSON",data:JSON.stringify(h),success:function(o){ngds.publish("data-loaded",{});return m(o)}})},transform_neg:function(d){var b=Number(d);var a=0;if(b<0){a=-(Math.abs(b)+2)}else{a=b-2}return a},transform_pos:function(d){var b=Number(d);var a=0;if(b<0){a=-(Math.abs(b)-2)}else{a=b+2}return a},get_responsible_party:function(f,e){(function(){if(f===null||typeof f==="undefined"){throw"Expected valid id"}if(typeof e!=="function"){throw"Expected callback function"}})();var b="/api/action/additional_metadata";var a="ResponsibleParty";var d="read";var c={model:a,process:d,data:{id:f}};$.ajax({url:b,data:c,success:function(g){return e(g)}})}};