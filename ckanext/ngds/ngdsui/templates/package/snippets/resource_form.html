{% include 'package/resource_form_template.tmf' %}
{% include 'package/add_responsible_party.tmf' %}
<style>
  .wrapper {
    border:none;
    box-shadow:none;
  }
</style>
{% if include_metadata %}

{% endif %}
<script>
{% if data %}
    resource_location = window.location.origin+"{{data['resource_location']}}";
    ngds.util.state['edit_mode'] = true;
{% else %}
    ngds.util.state['edit_mode'] = false;
{% endif %}
    var content_models = {};
    var content_models_raw = [{% for item in h.get_content_models() %}{ "uri":"{{item['uri']}}","versions":"{{item['versions']}}","title":"{{item['title']}}" },{% endfor %}];
    for(var index in content_models_raw) {
        content_models[content_models_raw[index]['uri']] = {
            'versions':ngds.util.parse_raw_json(content_models_raw[index]['versions']),
            'title':content_models_raw[index]['title']
        };
    }
</script>

{% if data %}
<form class="dataset-form dataset-resource-form form-horizontal resource-edit-form" action="/dataset/new_resource/{{pkg_name}}" method="post" data-module="resource-form basic-form">
{% else %}
<form class="dataset-form dataset-resource-form form-horizontal" action="/dataset/new_resource/{{pkg_name}}" method="post" data-module="resource-form basic-form">
{% endif %}
    <input type="hidden" name="resource_type" value="file"/>
  <div data-module="resource-upload-field"></div>
    {% block stages %}
    {% if stage %}
  <ol class="stages stage-2">
    <li class="first-stage complete">
        <button class="highlight" name="save" value="go-dataset" type="submit">1. Create dataset</button>
    </li>
    <li class="middle-stage active">
        <span class="highlight">2. Add Resources</span>
    </li>
    <li class="last-stage uncomplete">
        <span class="highlight">3. Dataset Metadata</span>
    </li>
  </ol>
    {% endif %}
    {% endblock %}

  <div class="main-controls">
      <div class="radio-section">
        <!--<input type="radio" id="resource_type-selection" name="upload_type_selection" value="upload_type"/>-->
        <!--<label for="resource_type-selection">Upload a file</label><br>-->
          {% if data['resource_format'] %}
          <input type="hidden" name="resource_format" value="{{data['resource_format']}}" />
        &nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" id="resource_type-structured" class="resource_type" />
          {% else %}
        &nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" id="resource_type-structured" class="resource_type" name="resource_format" value="structured"/>
          {% endif %}

        <label for="resource_type-structured" id="resource_type-structured-label">{{ _('Structured resource') }}</label><br>
          {% if data['resource_format'] %}
          &nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" id="resource_type-unstructured" class="resource_type" />
          {% else %}
          &nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" id="resource_type-unstructured" class="resource_type" name="resource_format" value="unstructured" />
          {% endif %}
        <label for="resource_type-unstructured" id="resource_type-unstructured-label">{{ _('Unstructured resource') }}</label>
      </div>

      <div class="radio-section">
        {% if data['resource_format'] %}
        <input type="radio" id="data-service" />
        {% else %}
          <input type="radio" id="data-service" name="resource_format" value="data-service" />
        {% endif %}
        <label for="data-service">{{ _('Link to a data service') }}</label>
      </div>

      <div class="radio-section">
          {% if data['resource_format'] %}
        <input type="radio" id="offline-resource" />
         {% else %}
         <input type="radio" id="offline-resource" name="resource_format" value="offline-resource" />
          {% endif %}
        <label for="offline-resource">{{ _('Offline resource') }}</label>
      </div>
      {% if data['id'] %}
        <input type="hidden" name="id" value="{{data['id']}}" />
      {% else %}
        <input type="hidden" name="id" value="" />
      {% endif %}


  </div>

  <div class="form-body">
   <!-- Offline Resource End -->

  </div>
  <div class="form-actions">
    {% block delete_button %}
      {% if data.id %}
        {% if h.check_access('resource_delete', {'id': data.id})  %}
          {% set locale = h.dump_json({'content': _('Are you sure you want to delete this resource?')}) %}
          <a class="btn btn-danger pull-left" href="{% url_for controller='package', action='resource_delete', resource_id=data.id, id=pkg_name %}" data-module="confirm-action" data-module-i18n="{{ locale }}">{% block delete_button_text %}{{ _('Delete') }}{% endblock %}</a>
        {% endif %}
      {% endif %}
    {% endblock %}
        {% if stage %}
            {% block previous_button %}
                <button type="submit" name="save" value="go-dataset">{{ _('Previous Page') }}</button>
            {% endblock %}
            {% block again_button %}
                <button type="submit" name="save" value="again">{{ _('Save and Add Another') }}</button>
            {% endblock %}
            <button type="button" class="{% block pull_right %}{% endblock %}" id="go-metadata">{% block save_button_text %}{{ _('Next: Additional Metadata') }}{% endblock %}</button>
        {% else %}
            <button class="btn btn-primary pull-right" name="save" value="go-dataset-complete" type="submit">{{ _('Add') }}</button>
        {% endif %}
        <!-- <button type="button" name="save" value="go-metadata">Additional Metadata</button> -->

    </div>
</form>

{% raw %}
<script type="text/javascript" src="/scripts/contribute/responsible_party.js"></script>
<script type="text/javascript" src="/scripts/contribute/resource_form_fields.js"></script>
<script type="text/javascript" src="/scripts/autocomplete.js"></script>
<script type="text/javascript" src="/scripts/contribute/resource_form.js"></script>

<script>
</script>
{% endraw %}

<script>
$(document).ready(function() {
(function template_variables_collect(){
  {% if data %}
  distributor = null;
    {% if data.distributor %}
    distributor = ngds.util.parse_raw_json("{{data.distributor}}");
   {% set dist = data['distributor'] %}
    {% endif %}

   data = ngds.util.parse_raw_json("{{data|replace(data.distributor,'')|replace('None','\"\"')|replace('False','false')|replace('True','true')}}");
   data['distributor'] = distributor;

   activate_populate_form(data);
   if(typeof distributor !== 'undefined' && distributor!==null && distributor !== "") {
       $("#distributor_name").val(distributor.name);
       $("#distributor_email").val(distributor.email);
     }
        if(typeof responsibilified !=='undefined') {
            responsibilified.slugify();
        }
        if (ngds.util.state['edit_mode'] === true && typeof data['content_model_version']!=='undefined') {
                populate_content_model_versions();
                $("[name=content_model_version]").val(data['content_model_version']);
        }
  {% endif %}
})();
});

</script>
